<utility-back-link-component [url]="url"></utility-back-link-component>

<form [formGroup]="form" class="row">
  <div class="row">
    <div class="col-lg-6 offset-lg-3 col-12">

      <div class="mt-3">
        <utility-card-component>
          <utility-header-card-component>
            Services
          </utility-header-card-component>
          <utility-body-card-component>
            <div class="form-check mb-4">
              <input class="form-check-input" formControlName="servicesAreProvidedInParallel" type="checkbox" [value]="true" id="servicesAreProvidedInParallel">
              <label class="form-check-label" for="servicesAreProvidedInParallel">
                Services are provided in parallel
              </label>
            </div>
            <div *ngFor="let service of form.controls.services.value" class="card border rounded-4 shadow-none mb-4">
              <ul class="list-group list-group-flush">
                <li class="bg-light list-group-item rounded-4">
                  <div class="d-flex w-100 justify-content-between">
                    <small>{{ service.languageVersions[0].language | language }}</small>
                  </div>
                  <p class="mb-1">{{service.languageVersions[0].title}}</p>
                </li>
                <li class="list-group-item">
                  <i class="bi bi-person"></i>
                  {{ service.permanentEmployees[0].employee.firstName }} {{ service.permanentEmployees[0].employee.lastName }}
                </li>
                <li class="list-group-item">Duration: {{ service.durationVersions[0].duration }} minut</li>
                <li class="list-group-item">
                  Price: {{ service.durationVersions[0].prices[0].price }} {{ service.durationVersions[0].prices[0].currency }}</li>
              </ul>
              <div class="card-body d-flex justify-content-between">
                <button (click)="editServiceFromSelectedList(service)" class="btn btn-outline-warning">Edit</button>
                <button (click)="removeServiceFromSelectedList(service)" class="btn btn-outline-danger">Delete</button>
              </div>
            </div>
            <div class="d-grid">
              <button
                beeoclock
                [disabled]="form.disabled"
                [showLoader]="form.pending"
                (click)="openServiceModal()">
                Add service
              </button>
            </div>
          </utility-body-card-component>
        </utility-card-component>
      </div>
      <div class="mt-3">
        <utility-card-component>
          <utility-header-card-component>
            Attendees
          </utility-header-card-component>
          <utility-body-card-component>
            <event-attendees-component [form]="form.controls.attendees"></event-attendees-component>
          </utility-body-card-component>
        </utility-card-component>
      </div>
      <div class="mt-3">
        <utility-card-component>
          <utility-body-card-component>
            <div class="row">
              <div class="col-md-12 position-relative">
                <label for="event-form-start">Start</label>
                <input
                  hasError
                  id="event-form-start"
                  type="text"
                  class="form-control"
                  mwlFlatpickr
                  formControlName="start"
                  altFormat="H:i d-m-Y"
                  [time24hr]="true"
                  [enableTime]="true"
                  [altInput]="true"
                  [convertModelValue]="true"
                />
                <utility-input-error-component [control]="form.controls.start"></utility-input-error-component>
                In future add feature to chose slots
              </div>
            </div>
            <div class="col-12 mt-3">
              Duration:
              <ng-container *ngIf="!duration">
                <small class="text-warning">Select services to calculate duration of event</small>
              </ng-container>
              <ng-container *ngIf="duration">
                {{ duration }} minut
              </ng-container>
            </div>
            <div class="col-12 mt-3">
              Finish at:
              {{ form.controls.end.value | date: 'full' }}
            </div>
            <div class="col-12 mt-3">
              <label for="event-form-description">Description</label>
              <textarea
                beeoclock
                hasError
                placeholder="Write some description of event"
                id="event-form-description"
                formControlName="description"></textarea>
              <utility-input-error-component [control]="form.controls.description"></utility-input-error-component>
            </div>
          </utility-body-card-component>
        </utility-card-component>
      </div>
      <div class="col-12 d-grid mt-3">
        <button
          beeoclock
          [disabled]="form.disabled"
          [showLoader]="form.pending"
          (click)="save()">Save
        </button>
      </div>
    </div>
  </div>
</form>
