<filter-calendar-with-specialist [orderServiceStatusesControl]="orderServiceStatusesControl" [memberListControl]="memberIdListControl"/>

<div class="flex flex-col h-[calc(100%-60px)] overflow-auto w-full border-b">

	<!-- Header Row with Days -->
	<div class="flex bg-white sticky top-0 z-20 border-b">
		
		<!-- Specialists Column Header -->
		<div class="min-w-36 max-w-36 w-36 border-r bg-white px-4 py-2 flex items-center">
			<span class="text-sm font-medium text-gray-700">{{ 'calendar.specialists' | translate }}</span>
		</div>

		<!-- Weekday Headers -->
		@for (weekday of weekdays; track weekday.number) {
			<div class="flex-1 min-w-32 border-r bg-white px-2 py-2 flex items-center justify-center">
				<span class="text-sm font-medium text-gray-800">{{ weekday.translationKey | translate }}</span>
			</div>
		}

	</div>

	<!-- Specialist Rows -->
	<div class="flex flex-col">
		
		@for (member of memberList; track member._id) {
			@if (memberIdListControl.getRawValue().includes(member._id)) {
				
				<!-- Specialist Row -->
				<div class="flex border-b last:border-none min-h-44">
					
					<!-- Specialist Name Column -->
					<div class="min-w-36 max-w-36 w-36 border-r bg-white px-1 flex items-center justify-end">
						<div class="text-sm font-medium text-gray-700 text-right">
							{{ member.firstName }} {{ member.lastName }}
						</div>
					</div>

					<!-- Weekday Columns for this Specialist -->
					@for (weekday of weekdays; track weekday.number) {
						<div class="flex-1 min-w-32 border-r bg-white p-1 relative flex flex-col">
							
							<!-- Absences for this day -->
							@if (eventsBySpecialistId[member._id]?.[weekday.number]?.absences; as absences) {
								@for (absence of absences; track absence._id) {
									<div class="bg-red-100 border border-red-300 rounded p-1 mb-1 text-xs hover:bg-red-200 transition-colors cursor-pointer flex-shrink-0">
										<div class="font-medium text-red-800">{{ 'calendar.absence' | translate }}</div>
										<div class="text-red-600 truncate">еуіе
										</div>
									</div>
								}
							}

							<!-- Order Services for this day -->
							@if (eventsBySpecialistId[member._id]?.[weekday.number]?.orderServices; as orderServices) {
								@for (orderService of orderServices; track orderService._id) {
									<div class="bg-blue-100 border border-blue-300 rounded p-1 mb-1 text-xs hover:bg-blue-200 transition-colors cursor-pointer flex-shrink-0">
										<div class="font-medium text-blue-800">{{ 'calendar.service' | translate }}</div>
										<div class="text-blue-600 text-xs">
										еуіе
										</div>
										@if (orderService.orderAppointmentDetails.end) {
											<div class="text-blue-500 text-xs">
												
											</div>
										}
									</div>
								}
							}

							<!-- Empty state / flexible space -->
							@if (!eventsBySpecialistId[member._id]?.[weekday.number]?.absences?.length && 
								 !eventsBySpecialistId[member._id]?.[weekday.number]?.orderServices?.length) {
								<div class="flex items-center justify-center flex-1 text-gray-300 text-xs">
									{{ 'calendar.no_events' | translate }}
								</div>
							} @else {
								<!-- Flexible space to maintain row height consistency -->
								<div class="flex-1"></div>
							}

						</div>
					}

				</div>

			}
		}

	</div>
	
</div>
